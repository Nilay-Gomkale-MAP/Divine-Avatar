<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-hit-test@2.0.0/dist/aframe-hit-test.min.js"></script>
    <style>
      body, html { margin: 0; overflow: hidden; height: 100%; background: transparent; }
    </style>
  </head>
  <body>
    <a-scene
      renderer="alpha: true"
      webxr="mode: ar; requiredFeatures: hit-test;"
      xr-mode-ui="enabled: true; XRMode: ar;"
      vr-mode-ui="enabled: false"
      hit-test
    >
      <a-assets>
        <a-asset-item id="vahanModel" src="/vahan_model.glb"></a-asset-item>
      </a-assets>

      <a-entity
        id="vahan"
        gltf-model="#vahanModel"
        scale="0.5 0.5 0.5"
        animation-mixer
        visible="false"
      ></a-entity>

      <a-entity id="reticle" geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.06"
                material="color: green;" rotation="-90 0 0" visible="false"></a-entity>

      <a-entity camera look-controls></a-entity>
      <a-entity light="type: ambient" intensity="1"></a-entity>
      <a-entity light="type: directional" position="1 1 1" intensity="1"></a-entity>
    </a-scene>

    <script>
      const scene = document.querySelector('a-scene');
      const model = document.getElementById('vahan');
      const reticle = document.getElementById('reticle');
      let placed = false;

      scene.addEventListener('enter-vr', () => {
        if (!scene.is('ar-mode')) return;

        scene.addEventListener('hit-test-start', () => {
          reticle.setAttribute('visible', true);
        });

        scene.addEventListener('hit-test-end', () => {
          reticle.setAttribute('visible', false);
        });

        scene.addEventListener('hit-test-result', (e) => {
          if (placed) return;
          const position = e.detail.position;
          const rotation = e.detail.rotation;

          reticle.setAttribute('position', position);
          reticle.setAttribute('rotation', rotation);
        });

        scene.addEventListener('hit-test-select', () => {
          placed = true;
          model.setAttribute('visible', true);
          const pos = reticle.getAttribute('position');
          const rot = reticle.getAttribute('rotation');

          model.setAttribute('position', pos);
          model.setAttribute('rotation', rot);

          // Hide reticle after placement
          reticle.setAttribute('visible', false);
        });
      });
    </script>
  </body>
</html>
